<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Fantasy Draft Tracker — Quick Fix</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap for quick styling -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#121212; color:#eee; -webkit-font-smoothing:antialiased; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    .navbar { margin-bottom: 1rem; }
    .card { background:#1e1e1e; color:#eee; border:1px solid #2a2a2a; }
    .muted { color:#b8b8b8; font-size:.9rem; }
    .money { font-weight:700; }
    .drafted-row { opacity:.55; filter:grayscale(.3); }
    .drafted-chip { background:#233138; border:1px dashed #3a5a66; color:#d7ecf3; border-radius:999px; padding:2px 8px; font-size:.85rem; }
    .band { font-weight:700; border-radius:6px; padding:2px 8px; margin-right:6px; display:inline-block }
    .band.high { background:#28a745; color:#fff; }
    .band.medium { background:#ffc107; color:#111; }
    .band.low { background:#6ea8fe; color:#081028; }
    .band.other { background:#6c757d; color:#fff; }
    .btn-chip { background:#1f2a30; color:#e6f7ff; border:1px solid #37515c; border-radius:999px; padding:4px 10px; }
    .btn-chip.active { background:#2a885d; border-color:#2a885d; }
    .panel { background:#181818; border:1px solid #2a2a2a; border-radius:12px; padding:12px; }
    .collapsible-hint { color:#9ab1ba; font-size:.95rem; }
  </style>
</head>
<body>
  <!-- Load React **before** our app code -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Fantasy Draft Tracker</a>
      <div class="d-flex gap-2">
        <button id="nav-draft" class="btn btn-sm btn-outline-light">Draft</button>
        <button id="nav-managers" class="btn btn-sm btn-outline-light">Managers</button>
        <button id="nav-settings" class="btn btn-sm btn-outline-light">Settings</button>
      </div>
    </div>
  </nav>

  <main class="container" id="root"></main>

  <script>
  (function(){
    const e = React.createElement;
    const {useState, useEffect} = React;

    /* --- demo data (replace by CSV later) --- */
    const initialPlayers = [
      { name: "Ja'Marr Chase", teamAbbr:"CIN", pos:"WR", rank:1, bye:10 },
      { name: "Bijan Robinson", teamAbbr:"ATL", pos:"RB", rank:2, bye:5 },
      { name: "Patrick Mahomes", teamAbbr:"KC", pos:"QB", rank:1, bye:6 },
      { name: "Amon-Ra St. Brown", teamAbbr:"DET", pos:"WR", rank:3, bye:8 },
      { name: "Jahmyr Gibbs", teamAbbr:"DET", pos:"RB", rank:4, bye:8 }
    ];
    const initialManagers = ["My Team","Alice","Bob","Carol"];

    function rankBand(r){
      if(r==null) return 'other';
      if(r<=10) return 'high';
      if(r<=20) return 'medium';
      if(r<=30) return 'low';
      return 'other';
    }

    function App(){
      const [page,setPage] = useState('draft');
      const [players,setPlayers] = useState(initialPlayers);
      const [drafted,setDrafted] = useState([]); // array of {name, pos, rank, manager, cost, ts}
      const [managers] = useState(initialManagers);

      useEffect(()=>{
        document.getElementById('nav-draft').onclick=()=>setPage('draft');
        document.getElementById('nav-managers').onclick=()=>setPage('managers');
        document.getElementById('nav-settings').onclick=()=>setPage('settings');
      },[]);

      function onQuickDraft(player, cost, manager){
        if(!player || isNaN(cost) || cost<0.5 || (cost*2)%1!==0) return; // min $0.50, step $0.50
        // Add to drafted list
        const entry = { name:player.name, pos:player.pos, rank:player.rank, manager, cost:Number(cost), ts:Date.now(), teamAbbr:player.teamAbbr, bye:player.bye };
        setDrafted(prev=>[...prev, entry]);
        // Grey-out in players list (mark draftedBy & cost)
        setPlayers(prev=> prev.map(p => (p.name===player.name && p.teamAbbr===player.teamAbbr)
          ? {...p, draftedBy:manager, draftCost:Number(cost)} : p
        ));
      }

      return e('div', {className:'pb-4'},
        page==='draft' && e(DraftPage, {players, drafted, managers, onQuickDraft}),
        page==='managers' && e(ManagersPage, {managers, drafted}),
        page==='settings' && e(SettingsPage)
      );
    }

    function DraftPage({players, drafted, managers, onQuickDraft}){
      const [search,setSearch]=useState('');
      const [draftedView,setDraftedView]=useState('collapsed'); // 'collapsed' | 'last3' | 'last10' | 'all'
      const filtered = players.filter(p=>{
        const q = search.trim().toLowerCase();
        if(!q) return true;
        return p.name.toLowerCase().includes(q) || p.pos.toLowerCase().includes(q) || p.teamAbbr.toLowerCase().includes(q);
      })
      // sort: undrafted first, then by rank
      .sort((a,b)=>{
        const ad=!!a.draftedBy, bd=!!b.draftedBy;
        if(ad!==bd) return ad?1:-1;
        return (a.rank||9999)-(b.rank||9999);
      });

      return e('div', {className:'row g-3'},
        e('div',{className:'col-12'},
          e('div',{className:'panel'},
            e('div',{className:'d-flex justify-content-between align-items-center mb-2'},
              e('h5',{className:'m-0'},'Draft — Available Players'),
              e('input',{type:'search',className:'form-control',style:{maxWidth:'260px'},placeholder:'Search player/team/pos…',value:search,onChange:(ev)=>setSearch(ev.target.value)})
            ),
            e('div',{className:'row g-3'},
              filtered.map(p=>{
                const drafted = p.draftedBy!=null;
                return e('div',{key:p.name+'-'+p.teamAbbr,className:'col-12 col-md-6 col-xl-4'},
                  e('div',{className:'card p-3 '+(drafted?'drafted-row':'')},
                    e('div',{className:'d-flex align-items-center justify-content-between mb-1'},
                      e('div',null,
                        e('div',null, e('span',{className:'band '+rankBand(p.rank)}, '#'+(p.rank??'—')), e('strong',null,p.name)),
                        e('div',{className:'muted'}, `${p.pos} • ${p.teamAbbr}` , p.bye?` • Bye ${p.bye}`:'')
                      )
                    ),
                    drafted
                      ? e('div',{className:'drafted-chip mt-1'}, `Drafted by ${p.draftedBy} • $${Number(p.draftCost||0).toFixed(2)}`)
                      : e(QuickDraftControls, {player:p, managers, onQuickDraft})
                  )
                );
              })
            )
          )
        ),

        e('div',{className:'col-12'},
          e('div',{className:'panel'},
            e('div',{className:'d-flex justify-content-between align-items-center mb-2'},
              e('h5',{className:'m-0'},'Drafted'),
              e('div',{className:'d-flex gap-2'},
                e('button',{className:'btn-chip',onClick:()=>setDraftedView('last3')},'Last 3'),
                e('button',{className:'btn-chip',onClick:()=>setDraftedView('last10')},'Last 10'),
                e('button',{className:'btn-chip',onClick:()=>setDraftedView('all')},'All'),
                draftedView!=='collapsed' && e('button',{className:'btn-chip',onClick:()=>setDraftedView('collapsed')},'Collapse')
              )
            ),
            draftedView==='collapsed'
              ? e('div',{className:'collapsible-hint'},'Select Last 3 / Last 10 / All to expand')
              : e(DraftedList,{drafted, view:draftedView})
          )
        )
      );
    }

    function QuickDraftControls({player, managers, onQuickDraft}){
      const [mgr,setMgr]=useState(managers[0]||'My Team');
      const [amt,setAmt]=useState(''); // start empty (no leading 0 annoyance)
      const valid = amt!=='' && !isNaN(parseFloat(amt)) && parseFloat(amt)>=0.5 && ((parseFloat(amt)*2)%1===0);
      return e('div',{className:'d-flex gap-2 align-items-center'},
        e('input',{type:'number',inputMode:'decimal',min:0.5,step:0.5,placeholder:'$',className:'form-control form-control-sm',value:amt,onChange:(ev)=>setAmt(ev.target.value),style:{maxWidth:'90px'}}),
        e('select',{className:'form-select form-select-sm',value:mgr,onChange:(ev)=>setMgr(ev.target.value),style:{maxWidth:'160px'}},
          managers.map(m=>e('option',{key:m,value:m},m))
        ),
        e('button',{className:'btn btn-sm btn-success',disabled:!valid,onClick:()=>{ if(valid){ onQuickDraft(player, parseFloat(amt), mgr); setAmt(''); } }}, valid?'Draft':'$0.50 step')
      );
    }

    function DraftedList({drafted, view}){
      let list = [...drafted];
      list.sort((a,b)=> b.ts - a.ts);
      if(view==='last3') list = list.slice(0,3);
      if(view==='last10') list = list.slice(0,10);

      if(!list.length) return e('div',{className:'muted'},'No picks yet');

      return e('ul',{className:'list-group'},
        list.map(d=> e('li',{key:d.ts,className:'list-group-item bg-dark text-light d-flex justify-content-between align-items-center'},
          e('span',null,
            e('span',{className:'band '+rankBand(d.rank)}, d.rank!=null?('#'+d.rank):'—'),
            ' ', d.name, ' (', d.pos, d.teamAbbr? ' • '+d.teamAbbr : '', d.bye? ' • Bye '+d.bye : '', ')'
          ),
          e('span',null, d.manager, ' — $', Number(d.cost||0).toFixed(2))
        ))
      );
    }

    function ManagersPage({managers, drafted}){
      return e('div',null,
        e('div',{className:'panel mb-3'},
          e('h5',null,'Managers Overview')
        ),
        e('div',{className:'panel'},
          e('table',{className:'table table-dark table-striped table-bordered align-middle m-0'},
            e('thead',null, e('tr',null, e('th',null,'Manager'), e('th',null,'Players'), e('th',null,'Spent $'))),
            e('tbody',null,
              managers.map(m=>{
                const mine=drafted.filter(d=>d.manager===m);
                const spent=mine.reduce((a,c)=>a+(c.cost||0),0);
                return e('tr',{key:m},
                  e('td',null,m),
                  e('td',null,mine.length),
                  e('td',null,Number(spent).toFixed(2))
                );
              })
            )
          )
        )
      );
    }

    function SettingsPage(){
      return e('div', {className:'panel'},
        e('h5',null,'Settings'),
        e('div',{className:'muted'},'(CSV uploads, roster sizes, etc. can live here in your full version.)')
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(e(App));
  })();
  </script>
</body>
</html>
