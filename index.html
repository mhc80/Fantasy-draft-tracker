<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Fantasy Auction Draft Tracker â€” v5.4 (Ranks on Drafted + Safer Undo)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    :root{
      --bg:#05090b; --grad1:rgba(52,199,89,.16); --grad2:rgba(80,180,255,.12);
      --panel:#0a1419; --panel-2:#0e1b22; --line:#1f3643;
      --muted:#c7d6de; --text:#eef6fa; --brand:#2bb673;
      --chip:#0c2a2a; --chip-line:#2b6a67;
      --tableHead:#dff0f7; --tableRow:#cfe3ec;
      --contrastHi:#e9fbff; --contrastMed:#d4e7ef;
    }
    body{
      background:
        radial-gradient(1200px 900px at 10% -10%, var(--grad1), transparent 40%),
        radial-gradient(1100px 700px at 110% -10%, var(--grad2), transparent 40%),
        var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }
    .app-header{ backdrop-filter: blur(8px); background: linear-gradient(135deg, rgba(43,182,115,.22), rgba(24,54,64,.65)); border-bottom:1px solid var(--line) }
    .navtabs{ gap:.5rem; flex-wrap:wrap }
    .tablink{ border:1px solid var(--line); background:transparent; color:var(--text); border-radius:999px; padding:.35rem .9rem }
    .tablink.active{ background:rgba(124,240,161,.16); border-color:rgba(124,240,161,.45) }

    .panel{ background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03)); border:1px solid var(--line); border-radius:16px }
    .panel-2{ background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)); border:1px solid var(--line); border-radius:14px }
    .panel-title{ font-weight:700; letter-spacing:.2px }
    .metric{ background:var(--panel-2); border:1px solid var(--line); border-radius:12px; padding:.8rem 1rem }
    .metric .label{ color:var(--muted); font-size:.85rem } .metric .value{ font-weight:800; font-size:1.35rem }

    .btn-primary{ background:var(--brand); border-color:var(--brand) }
    .btn-outline-contrast{ background:#0f1f27; color:var(--contrastHi); border:1px solid #2c4a59; font-weight:700 }
    .btn-chip{ background:#10232c; border:1px solid #2c4a59; color:var(--contrastHi); border-radius:999px; padding:.25rem .7rem; font-weight:700 }

    .form-control,.form-select{ background:#0a1216; color:var(--text); border:1px solid #2c4a59; border-radius:10px }
    .form-control::placeholder{ color:#7fa0b1; opacity:1 }

    .table, .table thead, .table tbody, .table tr, .table th, .table td { background-color: transparent !important; color: var(--tableRow); }
    .table th{ color:var(--tableHead); border-color:#203743; font-weight:700; background:#0c1a20 !important }
    .table td{ border-color:#1a2e38 }
    .list-group-item{ background:var(--panel) !important; color:var(--text) !important; border-color:var(--line) !important }

    .sticky{ position:sticky; top:12px; z-index:10 }
    .logo{ width:22px; height:22px; object-fit:contain; margin-right:.5rem; background:transparent; border-radius:0 }
    .logo-lg{ width:26px; height:26px; object-fit:contain; margin-right:.5rem; background:transparent; border-radius:0 }
    .pos-badge{ background:#12343e; border:1px solid #2b6a67; border-radius:999px; font-weight:700 }
    .money{ font-variant-numeric:tabular-nums }
    .chip{ display:inline-flex; align-items:center; gap:.35rem; padding:.3rem .6rem; background:var(--chip); border:1px solid var(--chip-line); border-radius:1000px; font-size:.85rem }
    .pill{ padding:.2rem .6rem; border:1px solid #2b6a67; border-radius:999px; background:#0c2225 }
    .divider{ height:1px; background:#183038; margin:.75rem 0 }
    .search{ max-width:340px }
    .muted{ color:var(--muted) }
    .row-strong{ color:var(--contrastMed); font-weight:600; letter-spacing:.2px }

    .band{ font-weight:800; border-radius:999px; padding:.15rem .5rem; border:1px solid transparent }
    .band.high{ color:#052916; background:rgba(68,226,138,.85); border-color:#38c172 }
    .band.medium{ color:#2d2000; background:rgba(255,209,102,.9); border-color:#e0b548 }
    .band.low{ color:#061a39; background:rgba(134,182,255,.9); border-color:#5b8ed6 }
    .band.other{ color:#0c1921; background:rgba(154,170,188,.75); border-color:#8b9aaa }

    .modal-content{ background:var(--panel)!important; color:var(--text)!important; border:1px solid var(--line)!important }
    .modal-header .btn-close{ filter: invert(1) contrast(2) }

    @media (orientation: portrait){
      .stack-portrait{ display:flex; flex-direction:column; gap:1rem }
      .sticky{ position:static }
    }
    @media (orientation: landscape) and (max-height: 520px){
      .table-responsive{ max-height:50vh !important }
    }
  </style>
</head>
<body>
<header class="app-header py-3 mb-3">
  <div class="container d-flex justify-content-between align-items-center">
    <div class="d-flex align-items-center gap-3">
      <h1 class="h4 m-0">Fantasy Auction Draft Tracker</h1>
      <nav class="d-none d-md-flex navtabs">
        <button id="tab-draft" class="tablink active" onclick="window.switchView('draft')">Draft</button>
        <button id="tab-managers" class="tablink" onclick="window.switchView('managers')">Managers</button>
        <button id="tab-settings" class="tablink" onclick="window.switchView('settings')">Settings</button>
      </nav>
    </div>
    <div class="small text-end">
      <div>Draft Day: <strong>Aug 17</strong></div>
      <div class="muted">Toggle PPR/Standard = switch league context</div>
    </div>
  </div>
</header>

<main class="container" id="root"></main>

<script>
const e = React.createElement;
const {useState,useEffect,useMemo} = React;
const STORAGE_KEY = 'auction_tracker_dual_league_dashboard_v5_4';
const MIN_BID = 0.5;

/* Logos */
const LOGO_CODE = { ARI:'ari', ATL:'atl', BAL:'bal', BUF:'buf', CAR:'car', CHI:'chi', CIN:'cin', CLE:'cle',
  DAL:'dal', DEN:'den', DET:'det', GBP:'gb', HOU:'hou', IND:'ind', JAX:'jax', KC:'kc',
  LV:'lv', LAC:'lac', LAR:'lar', MIA:'mia', MIN:'min', NE:'ne', NO:'no', NYG:'nyg',
  NYJ:'nyj', PHI:'phi', PIT:'pit', SF:'sf', SEA:'sea', TB:'tb', TEN:'ten', WAS:'wsh'
};
const TEAMS = [
  {abbr:'ARI',name:'Arizona Cardinals'},{abbr:'ATL',name:'Atlanta Falcons'},{abbr:'BAL',name:'Baltimore Ravens'},
  {abbr:'BUF',name:'Buffalo Bills'},{abbr:'CAR',name:'Carolina Panthers'},{abbr:'CHI',name:'Chicago Bears'},
  {abbr:'CIN',name:'Cincinnati Bengals'},{abbr:'CLE',name:'Cleveland Browns'},{abbr:'DAL',name:'Dallas Cowboys'},
  {abbr:'DEN',name:'Denver Broncos'},{abbr:'DET',name:'Detroit Lions'},{abbr:'GBP',name:'Green Bay Packers'},
  {abbr:'HOU',name:'Houston Texans'},{abbr:'IND',name:'Indianapolis Colts'},{abbr:'JAX',name:'Jacksonville Jaguars'},
  {abbr:'KC',name:'Kansas City Chiefs'},{abbr:'LV',name:'Las Vegas Raiders'},{abbr:'LAC',name:'Los Angeles Chargers'},
  {abbr:'LAR',name:'Los Angeles Rams'},{abbr:'MIA',name:'Miami Dolphins'},{abbr:'MIN',name:'Minnesota Vikings'},
  {abbr:'NE',name:'New England Patriots'},{abbr:'NO',name:'New Orleans Saints'},{abbr:'NYG',name:'New York Giants'},
  {abbr:'NYJ',name:'New York Jets'},{abbr:'PHI',name:'Philadelphia Eagles'},{abbr:'PIT',name:'Pittsburgh Steelers'},
  {abbr:'SF',name:'San Francisco 49ers'},{abbr:'SEA',name:'Seattle Seahawks'},{abbr:'TB',name:'Tampa Bay Buccaneers'},
  {abbr:'TEN',name:'Tennessee Titans'},{abbr:'WAS',name:'Washington Commanders'},
];

function TeamLogo({abbr, big}) {
  const code=LOGO_CODE[abbr]||abbr?.toLowerCase?.()||'';
  const url=`https://a.espncdn.com/i/teamlogos/nfl/500/${code}.png`;
  return e('img',{className: big?'logo-lg':'logo',alt:(abbr||'')+' logo',src:url,onError:(ev)=>{ev.currentTarget.style.display='none';}});
}

/* State helpers */
function useStoredState(initial){
  const [state,setState]=useState(()=>{const raw=localStorage.getItem(STORAGE_KEY); if(!raw) return initial; try{return JSON.parse(raw)}catch(_){return initial}});
  useEffect(()=>localStorage.setItem(STORAGE_KEY,JSON.stringify(state)),[state]);
  return [state,setState];
}
function initialLeagueTeams(names){
  return Array.from({length:10},(_,i)=>({id:i,name:names?.[i] || (i===0?'My Team':('Team '+(i+1))),spent:0,budget:200}));
}
function initialState(){
  const names = Array.from({length:10},(_,i)=> i===0?'My Team':'Team '+(i+1));
  return {
    view:'draft', scoring:'PPR',
    playersPPR:[], playersSTD:[],
    selectedTeam:'', pos:'ALL', q:'',
    rosterSize:16,
    targets:{ QB:1, RB:2, WR:2, TE:1, FLEX:1, K:1, DEF:1, BN:8 },
    participantNames: names,
    leagues:{ PPR:{teams:initialLeagueTeams(names), drafted:[]}, STD:{teams:initialLeagueTeams(names.map((n,i)=>i===0?'My Team (Std)':n)), drafted:[]} },
    detail:null, editDraft:null,
    draftedView:'last3'
  };
}

/* CSV parsing */
function normalizePos(pos){ if(!pos) return 'N/A'; const p=String(pos).toUpperCase().trim(); return p.replace(/[0-9]+$/,'').replace('DST','DEF'); }
function parseFPRowFlexible(r, idx){
  const obj = {}; for (const k in r) obj[(k||'').trim()] = r[k];
  const name = (obj['PLAYER NAME'] || obj['Player'] || obj['PLAYER'] || '').toString().trim();
  const team = (obj['TEAM'] || obj['Team'] || obj['NFL Team'] || obj['Tm'] || '').toString().trim().toUpperCase();
  const pos  = normalizePos(obj['POS'] || obj['Pos'] || obj['Position'] || '');
  const rk   = Number(obj['RK'] || obj['Rk'] || obj['Rank'] || obj['Overall'] || idx+1);
  const bye  = (obj
